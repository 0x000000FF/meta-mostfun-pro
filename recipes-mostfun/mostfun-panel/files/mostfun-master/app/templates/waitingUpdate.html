<!doctype html>
<html>
<head class = "no-js" lang = "en">
    <meta charset = "utf-8" />
    <meta name = "viewport" content = "width=device-width, initial-scale=1.0" />
    <link href="/static/app/css//bootstrap.min.css" rel="stylesheet">
    <title>mostfun Panel</title>
    <style>
        .cssload-thecube {
            width      : 75px;
            height     : 75px;
            margin     : 0 auto;
            margin-top : 50px;
            position   : relative;
            }
        .cssload-thecube .cssload-cube {
            position : relative;
            }
        .cssload-thecube .cssload-cube {
            float             : left;
            width             : 50%;
            height            : 50%;
            position          : relative;
            transform         : scale(1.1);
            -o-transform      : scale(1.1);
            -ms-transform     : scale(1.1);
            -webkit-transform : scale(1.1);
            -moz-transform    : scale(1.1);
            }
        .cssload-thecube .cssload-cube:before {
            content                  : "";
            position                 : absolute;
            top                      : 0;
            left                     : 0;
            width                    : 100%;
            height                   : 100%;
            background-color         : black;
            animation                : cssload-fold-thecube 2.76s infinite linear both;
            -o-animation             : cssload-fold-thecube 2.76s infinite linear both;
            -ms-animation            : cssload-fold-thecube 2.76s infinite linear both;
            -webkit-animation        : cssload-fold-thecube 2.76s infinite linear both;
            -moz-animation           : cssload-fold-thecube 2.76s infinite linear both;
            transform-origin         : 100% 100%;
            -o-transform-origin      : 100% 100%;
            -ms-transform-origin     : 100% 100%;
            -webkit-transform-origin : 100% 100%;
            -moz-transform-origin    : 100% 100%;
            }
        .cssload-thecube .cssload-c2 {
            transform         : scale(1.1) rotateZ(90deg);
            -o-transform      : scale(1.1) rotateZ(90deg);
            -ms-transform     : scale(1.1) rotateZ(90deg);
            -webkit-transform : scale(1.1) rotateZ(90deg);
            -moz-transform    : scale(1.1) rotateZ(90deg);
            }
        .cssload-thecube .cssload-c3 {
            transform         : scale(1.1) rotateZ(180deg);
            -o-transform      : scale(1.1) rotateZ(180deg);
            -ms-transform     : scale(1.1) rotateZ(180deg);
            -webkit-transform : scale(1.1) rotateZ(180deg);
            -moz-transform    : scale(1.1) rotateZ(180deg);
            }
        .cssload-thecube .cssload-c4 {
            transform         : scale(1.1) rotateZ(270deg);
            -o-transform      : scale(1.1) rotateZ(270deg);
            -ms-transform     : scale(1.1) rotateZ(270deg);
            -webkit-transform : scale(1.1) rotateZ(270deg);
            -moz-transform    : scale(1.1) rotateZ(270deg);
            }
        .cssload-thecube .cssload-c2:before {
            animation-delay         : 0.35s;
            -o-animation-delay      : 0.35s;
            -ms-animation-delay     : 0.35s;
            -webkit-animation-delay : 0.35s;
            -moz-animation-delay    : 0.35s;
            }
        .cssload-thecube .cssload-c3:before {
            animation-delay         : 0.69s;
            -o-animation-delay      : 0.69s;
            -ms-animation-delay     : 0.69s;
            -webkit-animation-delay : 0.69s;
            -moz-animation-delay    : 0.69s;
            }
        .cssload-thecube .cssload-c4:before {
            animation-delay         : 1.04s;
            -o-animation-delay      : 1.04s;
            -ms-animation-delay     : 1.04s;
            -webkit-animation-delay : 1.04s;
            -moz-animation-delay    : 1.04s;
            }
        @keyframes cssload-fold-thecube {
            0%,
            10% {
                transform : perspective(140px) rotateX(-180deg);
                opacity   : 0;
                }
            25%,
            75% {
                transform : perspective(140px) rotateX(0deg);
                opacity   : 1;
                }
            90%,
            100% {
                transform : perspective(140px) rotateY(180deg);
                opacity   : 0;
                }
            }
        @-o-keyframes cssload-fold-thecube {
            0%,
            10% {
                -o-transform : perspective(140px) rotateX(-180deg);
                opacity      : 0;
                }
            25%,
            75% {
                -o-transform : perspective(140px) rotateX(0deg);
                opacity      : 1;
                }
            90%,
            100% {
                -o-transform : perspective(140px) rotateY(180deg);
                opacity      : 0;
                }
            }
        @-ms-keyframes cssload-fold-thecube {
            0%,
            10% {
                -ms-transform : perspective(140px) rotateX(-180deg);
                opacity       : 0;
                }
            25%,
            75% {
                -ms-transform : perspective(140px) rotateX(0deg);
                opacity       : 1;
                }
            90%,
            100% {
                -ms-transform : perspective(140px) rotateY(180deg);
                opacity       : 0;
                }
            }
        @-webkit-keyframes cssload-fold-thecube {
            0%,
            10% {
                -webkit-transform : perspective(140px) rotateX(-180deg);
                opacity           : 0;
                }
            25%,
            75% {
                -webkit-transform : perspective(140px) rotateX(0deg);
                opacity           : 1;
                }
            90%,
            100% {
                -webkit-transform : perspective(140px) rotateY(180deg);
                opacity           : 0;
                }
            }
        @-moz-keyframes cssload-fold-thecube {
            0%,
            10% {
                -moz-transform : perspective(140px) rotateX(-180deg);
                opacity        : 0;
                }
            25%,
            75% {
                -moz-transform : perspective(140px) rotateX(0deg);
                opacity        : 1;
                }
            90%,
            100% {
                -moz-transform : perspective(140px) rotateY(180deg);
                opacity        : 0;
                }
            }
    </style>
</head>
<body>
<div style = "position: relative;top: 5em;">
    <div class = "cssload-thecube">
        <div class = "cssload-cube cssload-c1"></div>
        <div class = "cssload-cube cssload-c2"></div>
        <div class = "cssload-cube cssload-c4"></div>
        <div class = "cssload-cube cssload-c3"></div>
    </div>
    <div class="updating-block" style = "display:none;text-align: center;position: relative;top: 2em;">
        <div>下载完成，mostfun正在安装更新，请稍后...</div>
        <div>Download completed，mostfun  is installing updates,please hold on...</div>
    </div>

    <div class="updating-none" style = "text-align: center;position: relative;top: 2em;">
        <div id = "downloadName_cn"></div>
        <div id="downloadType_cn"></div>
        <div style="margin-bottom:20px;"><strong>正在下载，请稍后...</strong></div>
        <div id = "downloadName_en"></div>
        <div id="downloadType_en"></div>
        <div><strong>Downloading, please hold on...</strong></div>

        <div class="progress  progress-striped active" style="width:20%;margin:20px auto;">
            <div class="progress-bar" role="progressbar" ><strong class="progress-bar-num" style="color:black"></strong></div>
        </div>

    </div>

</div>
<script type = "text/javascript"
        src = "/static/app/js/thirdLib/bootstrapjs/vendor/jquery.min.js"
        charset = "utf-8"></script>
<script src="/static/app/js/thirdLib/bootstrapjs/bootstrap.min.js"></script>
<script type = "text/javascript" charset = "utf-8">
    function main() {
        var processNum = null;
        processNum     = setInterval(function () {
            $.ajax({
                type       : 'GET',
                async      : true,
                url        : '/get-download-progress/',
                contentType: 'application/x-www-form-urlencoded;charset=utf-8',
                success    : function (data) {
                    if (typeof data == 'string') {
                        data = JSON.parse(data);
                    }
                    console.info(data);
                    var is_finish = data.is_finish;
                    console.info(is_finish);
                    if(is_finish !=true){
                        var download_process = data.download_process,
                                update_type  = data.update_type,
                                ipk_name     = data.ipk_name;
                        $(".progress-bar")     .css("width",download_process);
                        $(".progress-bar-num") .html(download_process);
                        $("#downloadType_cn")  .html('更新的类型为:'+ update_type + ';');
                        $("#downloadName_cn")  .html('更新包的名字是' + ipk_name +';');
                        $("#downloadType_en")  .html('Update type is:'+ update_type + ';');
                        $("#downloadName_en")  .html('Update package name is' + ipk_name + ';');
                    }else{
                        $('.updating-none')   .css("display","none");
                        $(".updating-block")  .css("display","block");
                    }

                }
            });
        }, 1000);

        var intNum     = null;
        intNum         = setInterval(function () {
            $.ajax({
                type       : 'GET',
                async      : true,
                url        : '/device/state/',
                contentType: 'application/x-www-form-urlencoded;charset=utf-8',
                success    : function (data) {
                    var stateInfo = JSON.parse(data).msg;
                    if ('updating' !== stateInfo.state) {
                        clearInterval(intNum);
                        clearInterval(processNum);
                        window.location.href = '/';
                    }
                },
                error      : function (error) {
                    console.error(error);
                }
            });
        }, 1000);
    }
    main();
</script>
</body>
</html>